# Request For Comments 3: 工作项

Version: 4 20250402 192500

最近变更：

- Version 4
  - 明确了“交易”与“订单”的区别
- Version 3
  - 明确了“始发站”、“终到站”、“起始站”、“到达站”的区别
  - 约定了系统内货币
  - US1.2.1、US3.1.1：明确了车票预订时默认显示的价格为二等座价格
  - US1.2.1、US3.1.1：显示每种座位的价格
- Version 2
  - FE1.5新增US1.5.3，退出登录
  - FE1.5新增US1.5.4，查看与设置个人资料

缩写释义：

- EP：Epic，最大粒度的业务目标，代表需要**多个迭代周期**才能完成的战略级需求，聚焦“为什么做”，而非“如何做”。
- FE：Feature，Epic 下的具体功能模块 ，代表用户可感知的独立能力，可作为一个完整功能上线。
- US：User Story，从用户视角 描述的、可在一个迭代内（通常 1-3 天）完成的独立需求单元，验收标准明确 ：定义完成的具体条件。
- TSK：Task，Story 下的具体技术工作项 ，由开发者拆解并分配给个人，通常 0.5-2 天完成。

关于火车站点的约定：

- 始发站（Origin Station）：车次路线的第一个站，列车从此站发车
- 终到站（Terminal Station）：车次路线的最后一个站，列车运行至此结束
- 起始站（Departure Station）：乘客实际开始乘车的站点
- 到达站（Arrival Station）：乘客实际结束乘车的站点

关于货币的约定：

- 超级货币（Super Credit），缩写SC

关于交易和订单的约定：

- 一笔订单明确对应一个服务，例如：一张火车票、一个房间预订、一份火车餐
- 交易对应一笔支付，一个交易可包含多个订单，例如：添加多个乘车人后点击“预订”，产生多个订单，但只有一个交易；交易有“未支付”、“已支付”两种状态
- 只能取消“订单”，而不能取消“交易”
- 取消订单、失败订单的退款通过新的退款交易返还，原始支付交易不变

## EP1：构建核心火车票务系统

价值：实现用户从搜索到支付的全流程购票能力。
范围：车次查询、余票计算、座位选择、订单管理（仅实现直达车票购买）。

### FE1.1：缴费系统

功能点：

- 充值
- 余额显示
- 交易状态：已支付/未支付
- 触发：用户完成支付时，触发订单状态改变

#### US1.1.1：作为用户，我想进行充值，以便购买其它服务

验收标准：

- 在充值界面可输入充值金额（1—2000 SC）
- 点击充值按钮后，可返回充值成功/失败的结果，失败时显示具体原因

#### US1.1.2：作为用户，我想查询当前余额，以便决定是否需要充值

验收标准：

- 在“个人”页面，可显示实时余额

#### US1.1.3：作为用户，我想在购买服务需要缴费时，显示总金额，并请求确认，以便决定是否购买

验收标准：

- （仅供前期调试使用）当前端及后端运行在 Debug 模式时，点击“测试购买”按钮并输入购买金额，弹出支付界面，并显示购买金额。
- 若余额充足，“支付”按钮显示为可点击状态
- 若余额不足，“支付”按钮显示为不可点击状态，点击时提示余额不足

#### US1.1.4：作为用户，我想支付时，需要使用 6 位数字支付密码做验证，以便保证便捷性和安全性

验收标准：

- 在“个人”页面，可设置 6 位数字支付密码（要求使用用户密码验证）
- 在支付界面，点击“支付”按钮后，要求输入 6 位数字支付密码
- 若连续 5 次输入错误，则要求输入用户密码，并给出重置密码选项

#### US1.1.5：作为用户，我想在购买服务需要缴费时，可以暂不进行支付，并在稍后再支付，以便进行充值等其它操作

验收标准：

- 用户可随时关闭支付界面
- 用户可在交易中的“待支付”类别中看到未支付的交易，以及其关联的订单
- 用户可点击未支付的交易，重新打开支付界面进行支付

#### US1.1.6：作为用户，我想完成支付后，相关订单能够得到执行，以便自己的需求得到满足

验收标准：

- 支付完成后，订单变为“已支付”状态
- 已支付订单被加入到消息队列中，待后端进行购票、预订酒店等实际处理

### FE1.2：实时车次查询引擎

功能点：

- 条件筛选：只看有座位、只看高铁/动车、只看普通车
- 排序：旅途总时长、出发时间早晚、价格
- 余票缓存

#### US1.2.1：作为乘客，我想查询请求能返回需要的信息，并够快速得到响应，以便于合理规划

验收标准：

- 选择“火车票”选项卡，应当切换到火车票购票界面
- 选择“直达”选项，进入直达查询模式
- 选择起始站、到达站、出发时间并点击查询后，响应时间<1s
- 查询结果界面应当包含如下内容：
  - 筛选选项：只看高铁、只看普通车、只看有票
  - 排序选项：按出发时间、按行程时间、按价格
  - 车次信息：
    - 起始站、离开“起始站”时间；到达站、到达“到达站”时间
    - 始发站、始发时间；终到站、终到时间
    - 车次号
    - 行程时间
    - 价格（当前余票的最低票价）
    - 车次信息（所有途径站点，每个站点的到达时间与出发时间）
    - 剩余座位信息：
      - 每种座位类型的剩余数量，每种座位的价格
      - 对于剩余数量>20%的，显示为有票（绿色）；<20%的，显示为剩余张数（黄色）；无剩余座位的，显示为无票（红色）

#### US1.2.2：作为乘客，我想按出发时间排序车次，以便快速找到最早班次

验收标准：

- 车次列表默认按出发时间升序排列
- 支持切换为按旅途总时长、价格排序
- 排序响应时间<200ms

#### US1.2.3：作为乘客，我想能够只查看有余票的车次，以便于安排行程

验收标准：

- 车次列表默认显示所有车次及剩余座位数量（按座位类别分）
- 支持切换为仅显示有剩余座位的车次
- 空结果时显示友好提示

### US1.2.4：作为商务旅客，我想过滤只看高铁车次，避免浪费时间

验收标准：

- 筛选栏包含"高铁"选项
- 选择后列表仅显示 G/C/D 字头车次
- 空结果时显示友好提示

### FE1.3：高并发购票系统

功能点：

- 保证数据一致性
- 处理大量并发请求
- 失败通知与回滚机制

#### US1.3.1：作为乘客，我想能预先设定乘车人信息、偏好的座位等，以便于在实际购票时不耽误时间

验收标准：

- 在“个人”界面，应当能为每个乘车人设置姓名、身份证号、偏好座位等信息
- 在提交订单时，应默认按设置好的乘车人信息进行选择，同时允许手动修改
- 在用户第一次使用时，应当告知相关功能的存在

#### US1.3.2：作为乘客，我想在提交订单后快速得到响应，以便于确认支付是否成功

验收标准：

- 支付成功后，应在 1s 内确认订单已经成功提交（加入后端消息队列），并向用户显示消息

#### US1.3.3：作为乘客，我想能够确认订单是否成功，以便安排行程

验收标准：

- 订单已经成功提交后，应在 5min 内确定订单是否成功

#### US1.3.4：作为乘客，我想对于失败的订单，能够及时获得退款，以便进行其它安排

验收标准：

- 对于失败的订单，应进行退款

### FE1.4：订单状态管理

功能点：

- 取消订单：取消条件判断（发车时间、是否以及取消过）
- 历史订单查询
- 应具有可拓展性，满足之后酒店、火车餐的订单管理

#### US1.4.1 作为乘客，我想查询行程（未结束的订单），以便安排行程

验收标准：

- 在“订单”界面，默认按时间做排序
- 未结束的订单、已经结束的订单、失败的订单，三者在视觉上应该有所区分
- 将来的行程独立成”行程“模块，显示账号本人的行程信息，未出行与已完成在视觉上有所区分

#### US1.4.2 作为乘客，我想能够查看订单详情，以便进行核对

验收标准：

- 对于“订单”界面的每笔订单，点击后应当能进入对应的“订单详情”界面
- “订单详情”界面应含有如下信息：
  - 订单状态：
    - 未支付：订单已经生成，还支付
    - 已支付：订单已经生成，且支付成功，此时订单将进入后端消息队列；系统处理完成后，进入「成功」状态
    - 未出行：订单已被后端处理，且成功（例如，火车订票有符合条件的座位，订票成功），还没有出行
    - 行程中：行程正在进行（例如，火车订票已经过始发站，还未到达终到站）
    - 已完成：行程已经完成（例如，火车订票已到达终到站）
    - 失败：订单已被后端处理，且失败（例如，火车订票没有符合条件的座位，订票失败）
    - 已取消：订单被用户取消
  - 支付时间
  - 订单类型：火车票、酒店预订、火车餐饮
  - 订单号
  - 订单详情：
    - 火车票：车次、离开起始站时间、乘车人、座位号、金额
    - 酒店预订：酒店名称、旅客名、房间类型、住宿时间、金额
    - 火车餐预订：车次、用餐人、用餐时间、菜品、金额
  - 订单操作按钮：
    - 对于“未支付”状态的订单，显示支付按钮
    - 对于“已支付”、“未出行”（且距离出行时间大于约定值）的订单，显示取消订单按钮
    - 对于“未出行”（且距离出行时间小于约定值）、“行程中”、“已完成”，显示不可点击的取消订单按钮，且显示不可取消原因。
    - 对于“失败”、“已取消”的订单，不显示按钮

#### US1.4.3 作为乘客，我想能够取消订单，以便应对行程变更

验收标准：

- 对于符合条件的订单，能点击“取消订单”按钮进行取消操作（详见 US1.4.2）

### FE1.5：用户注册与登录

功能点：

- 用户注册与登录
- 用户注销
- 用户个人资料管理

#### US1.5.1：作为新用户，我想能够注册账号，以便使用服务

验收标准：

- 注册需填写用户名、密码、确认密码
- 自动跳转至登录界面

#### US1.5.2：作为用户，我想能够登录账号，以便使用服务

验收标准：

- 填写正确的用户名、密码后，成功登录平台
- 对于首次登录的用户，自动跳转至个人资料设置界面，设置完成后自动跳转至首页
- 对于非首次登录的用户，自动跳转至首页

#### US1.5.3：作为用户，我想能够退出账号，以便切换其它账号

验收标准：

- 点击“个人”选项卡，可退出当前登录用户
- 退出后回到未登录状态

#### US1.5.4：作为用户，我想能够查看与设置个人资料，以便更好地使用服务

验收标准：

- 点击“个人”选项卡，进入个人资料界面
- 个人资料界面应当包含如下信息：
  - 用户名
  - 性别（选填）
  - 年龄（选填）
  - 手机号（应当进行脱敏处理）
  - 邮箱（应当进行脱敏处理）
  - 设置按钮：点击可修改上述个人资料中的：性别、年龄、手机号、邮箱

## EP2：打造一站式旅游服务平台

价值：整合火车票+酒店预订+火车餐购买服务，完善通知功能，提升用户粘性。
范围：酒店搜索、酒店推荐、酒店详情、酒店预订、酒店评分与评价、火车餐预订、通知功能。

### FE2.1：酒店服务

功能点：

- 高级搜索：查询酒店名称、城市
- 排序：根据价格、评分排序
- 酒店详情：查看用户评价以及评分、总体评分，住过（预订且未退订）的用户可发表评论并评分
- 酒店预订：显示每种类型房间的剩余量以及价格，并能进行预订操作
- 整合之前的订单管理系统

#### US2.1.1 作为旅客，我想按照酒店名称、城市查询酒店，以便了解目的地附近的酒店信息

验收标准：

- 选择“酒店”选项卡，应当切换到酒店预订界面
- 在搜索框左侧，应当能选择目的城市/目的火车站
  - 应当能通过下拉列表直接选择，
  - 并且能输入拼音首字母、拼音全拼、中文进行搜索
- 在搜索框中，可输入酒店名称进行搜索
  - 应当允许搜索框中不输入任何内容
  - 应当在未输入内容时，在搜索框中以默认文字提示用户可以不输入内容直接搜索
- 查询结果默认应当按评分排序
- 查询结果界面默认应当包含如下内容：
  - 排序条件：按评分、按价格、按订购人次
  - 筛选条件：
    - 房间类型：可多选
    - 住宿时间：起始--结束
  - 未进行筛选时，酒店有任意类型的空闲房间即在查询结果中包含该酒店；有筛选条件时，只有有符合筛选条件的房间的才显示
  - 酒店概览信息：
    - 酒店名称
    - 酒店图片
    - 酒店评分以及评分人数
    - 酒店累计预订人次
    - 酒店价格（若未进行筛选，则显示最低价格；若进行筛选，显示符合条件的最低价格）

#### US2.1.2 作为旅客，我想查看选定酒店的详细信息，以便进行对比并选择是否预订

验收标准：

- 查询酒店后，点击任意查询到的酒店，应当进入酒店详情界面
- 酒店详情界面应当包含如下信息：
  - 酒店名称
  - 酒店详细地址
  - 联系电话
  - 酒店评分以及评分人数
  - 酒店累计预订人次
  - 用户留言
    - 用户名
    - 留言时间
    - 评分
    - 留言内容
  - 对于每个房间类型（优先显示“查询酒店”时筛选的房间类型（若有），住宿时间默认按照“查询酒店”时选定的设置）：
    - 类型名称
    - 可入住人数
    - 剩余数量
    - 价格
    - 预订按钮
- 用户应当能随时访问预订列表（详见 US2.1.3）

#### US2.1.3 作为旅客，我想能方便地为自己和同行的人预订酒店，以便安排行程

验收标准：

- 在酒店详情页面点击“预订按钮”后，应弹出“预订”悬浮窗
  - 在悬浮窗中，应当能设置住宿时间
  - 提供两个按钮：继续添加房间、确认预订信息；点击任意按钮后，该房间应加入预订列表，悬浮窗应当关闭
    - 点击“继续添加房间”按钮后，用户可以继续选择其它房间进行预订
    - 点击“确认预订信息”按钮后，跳转至提交订单界面，需包含已在预订列表中的所有添加的房间
  - 提供关闭按钮，点击后悬浮窗关闭，不添加房间至预订列表中
- 在悬浮窗中预订的信息，应当保存到类似网购平台“购物车”的预订列表中
- 点击预订列表图标，可以悬浮窗或侧边栏的方式显示预订列表，其中应当包含如下信息：
  - 对于每个房间
    - 房间类别
    - 住宿时间
    - 价格
  - 总价
  - 提交订单按钮
- 用户应当能从预订列表中移除预订项目（或者勾选）
- 提交订单后，应进入订单支付流程

#### US2.1.4 作为旅客，我想按通用的方式完成所有类型订单的处理，以减轻心智负担

验收标准：

- 酒店预订订单的处理流程和火车票预订相同

#### US2.1.5 作为旅客，我想能对住过的酒店进行评价，以便其它旅客参考

验收标准：

- 在酒店详情页面，应当有“撰写评价”按钮
- 应当只有住过该酒店的用户，才能为该酒店撰写评价（撰写评价按钮为可点击状态）
- 若用户不能撰写评价，撰写评价按钮应为不可点击状态，并显示不能撰写评价的原因
- 评价应当包含评分（0 到 5 之间的实数）以及评论（文本，最多 1024 字节）
- 对于每个用户，其有多少个该酒店的已完成订单（按订单数量计算），则可以撰写对应条数的评价

### FE2.2：火车餐服务

功能点：

- 查询：查看对应班次可选的火车餐
- 火车餐预订：对应到车次，支持用餐时间选择（时间是否合法？）
- 整合之前的订单管理系统

#### US2.2.1：作为旅客，我想查看火车餐，以便决定是否预订

验收标准：

- 在首页展示火车餐预订的入口，点击后进入“火车餐预订”界面
- 火车餐预订界面支持按车次查询、日期（时间）查询、~~始发终到站查询（等待需求确定）~~
- 优先展示用户即将乘坐的车次
- 火车餐预订界面应当包含如下信息：
  - 车次
  - 始发时间、到达时间
  - 用餐时间选择：日期+午餐/晚餐
  - 对于每个可选的火车餐：
    - 名称
    - 图片
    - 价格
    - 预订按钮
      - 若用户有该车次的车票，则可以点餐，预订按钮为可以点击状态
      - 若用户无该车次的车票，则不能点餐，预订按钮为不可点击状态，且鼠标悬停时显示不可点餐原因

#### US2.2.2：作为旅客，我想预订火车餐，以便解决饮食问题

验收标准：

- 在火车餐预订页面点击“预订按钮”后，应弹出“预订”悬浮窗
  - 在悬浮窗中，应当能设置用餐人、份数
  - 提供两个按钮：继续添加、确认点餐；点击任意按钮后，该火车餐应加入预订列表，悬浮窗应当关闭
    - 点击“继续添加”按钮后，用户可以继续选择其它火车餐进行预订
    - 点击“确认点餐”按钮后，跳转至提交订单界面，需包含已在预订列表中的所有添加的火车餐
  - 提供关闭按钮，点击后悬浮窗关闭，不添加火车餐至预订列表中
- 在悬浮窗中预订的信息，应当保存到类似网购平台“购物车”的预订列表中
- 点击预订列表图标，可以悬浮窗或侧边栏的方式显示预订列表，其中应当包含如下信息：
  - 对于每个用餐人
    - 火车餐名称
    - 单价
    - 份数（用户应当能调整份数）
    - 单项总价
  - 总价
  - 提交订单按钮
- 用户应当能从预订列表中移除预订项目（或者勾选）
- 提交订单后，应进入订单支付流程

#### US2.2.3 作为旅客，我想按通用的方式完成所有类型订单的处理，以减轻心智负担

验收标准：

- 火车餐预订订单的处理流程和火车票预订相同

### FE2.3：完善通知功能

功能点：

- 显示订购成功/失败、取消订购成功/失败、火车发车提示
- 查看历史通知

#### US2.3.1：作为乘客，我想得知订单是否成功，以便于安排行程

验收标准：

- 当出现订购成功/失败、取消订购成功/失败事件时，在页面上显示通知（无论当前正在浏览哪个部分）
- 当天有行程时，在页面上显示通知（无论当前正在浏览哪个部分），首页增加组件展示

#### US2.3.2：作为乘客，我想查看历史通知，以便于回顾行程

验收标准：

- 当用户点击标题栏中的“消息”按钮时，可进入历史消息界面
- 历史消息界面应当包含如下内容：
  - 筛选条件
    - 日期范围
    - 消息类型：订单通知、行程通知
  - 消息列表：按时间排序
    - 对于每条消息：
      - 消息类别
      - 消息标题
      - 发送时间
      - 消息内容

## EP3：实现智能换乘推荐系统

价值：解决复杂出行需求，提升订单转化率。
范围：火车换乘、智能行程推荐（智能推荐火车餐、目的地酒店等）

### FE3.1：火车换乘功能

功能点：

- 实现经过一次中转的换乘查询：
  - 支持在同一个站内换乘、同城换乘、座位换乘
  - 实现换乘时间估计函数$f(A, B)$，估计从 A 站下车，到 B 站上车需要的时间
  - 根据$f(A, B)$判断时间上能否安全地完成换乘
- 排序：旅途总时长、出发时间早晚、价格

#### US3.1.1：作为乘客，我想换乘查询请求能返回需要的信息，并够快速得到响应，以便于合理规划

验收标准：

- 选择“火车票”选项卡，应当切换到火车票购票界面
- 选择“中转”选项，进入中转查询模式
- 选择起始站、到达站、出发时间并点击查询后，响应时间<1s
- 查询结果界面应当包含如下内容：
  - 筛选选项：只看高铁/动车、只看普通车、只看有票
  - 排序选项：按出发时间、按行程时间、按价格
  - 车次信息：
    - 第一程：起始站、离开“起始站”时间；到达站、到达“终到站”时间；第二程：起始站、离开“起始站”时间；到达站、到达“终到站”时间
    - 中间换乘可用的时间
    - 第一程车次号、第二程车次号
    - 第一程行程时间、第二程行程时间，全程时间
    - 价格（两程各自余票的最低票价之和）
    - 剩余座位信息：
      - 对于每一程：
        - 每种座位类型的剩余数量，每种座位的价格
        - 对于剩余数量>20%的，显示为有票（绿色字体）；<20%的，显示为剩余张数（黄色字体）；无剩余座位的，显示为无票（红色字体）
    - 预订按钮

#### US3.1.2：作为乘客，我想预订中转车票，以便于安排行程

- 在中转查询结果界面，点击“预订”按钮，进行火车票预订
- 在提交订单时，应默认按设置好的乘车人信息进行选择，同时允许手动修改
- 对于中转的两个车次，用户应当能单独设置座位等级，但默认应当对所有乘车人保持相同
- 若有订单部分失败（其中一个车次恰好无剩余座位），应当回滚整个操作并通知用户

### FE3.2：智能行程推荐

功能点：

- 根据目的地，推荐评价较高的酒店
- 若乘坐火车的时间跨越了饭点，进行相应的火车餐推荐

#### US3.2.1：作为旅客，我想根据目的地信息，获得附近酒店的推荐，以便于安排行程

- 在“首页”，自动根据用户预订成功的火车票订单的目的地，推荐附近的酒店
- 对于每个可能的目的地：
  - 在首页中分出一栏，显示评价较高的酒店
  - 对于每个酒店，应当包含如下信息：
    - 酒店名称
    - 酒店图片
    - 酒店评分以及评分人数
    - 酒店累计预订人次
    - 酒店人均消费

#### US3.2.2：作为旅客，我想根据车程安排，获得火车餐的推荐，以便于解决饮食问题

- 在“首页”，自动根据用户预订成功的火车票订单的车程，推荐火车餐
- 对于每个可能的车程：
  - 在首页中分出一栏，显示推荐的火车餐
  - 对于每个火车餐，应当包含如下信息：
    - 火车餐名称
    - 火车餐图片
    - 火车餐价格

## EP4：保障用户隐私与数据安全

价值：确保用户敏感信息（支付密码、身份证号）安全存储与传输。

### FE4.1：数据加密与脱敏

#### US4.1.1：作为用户，我想我的登录密码被加密存储，身份证号自动脱敏，防止泄露

验收标准：

- 数据库中的登录密码采用加盐哈希存储
- 页面展示身份证号时自动脱敏（如：`320***********1234`）
- 个人资料界面展示手机号、邮箱时自动脱敏

## EP5：提升用户体验

价值：提升用户使用平台的流畅度与舒适度。
范围：页面加载速度、交互设计、视觉设计。

### FE5.1：交互设计

功能点：

- 美观的UI设计
- 易上手、无须过多引导的交互逻辑
- 友好的提示信息
- 响应式设计
